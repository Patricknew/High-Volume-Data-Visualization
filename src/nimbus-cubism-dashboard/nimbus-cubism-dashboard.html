<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/iron-localstorage/iron-localstorage.html">
<link rel="import" href="../influxdb-connection/influxdb-connection.html">
<link rel="import" href="../influxdb-query/influxdb-query.html">
<link rel="import" href="../cubism-chart/cubism-chart.html">
<link rel="import" href="../nimbus-influxdb-filter/nimbus-influxdb-filter.html">

<dom-module id="nimbus-cubism-dashboard">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>
    
    <iron-localstorage name="cubism-connection" value="{{connection}}"
        on-iron-localstorage-load-empty="initializeConnection"></iron-localstorage>

    <influxdb-connection connection="{{connection}}"></influxdb-connection>
    <br/>
   
    <paper-button id="execute" raised>Show Wells</paper-button>
    <!-- <well-names id="wellNames" connection="[[connection]]" result="{{wellNames}}"></well-names>  -->
    <nimbus-influxdb-filter id="wellNames" connection="[[connection]]" result="{{selectedWells}}"
     query='SHOW MEASUREMENTS' regex=/(.*?)\..*$/></nimbus-influxdb-filter>
    [[selectedWells]]
    <br/>
    <br/>
    <paper-button id="showMeasurements" raised>Show Measurements</paper-button>
    <nimbus-influxdb-filter id="measurementNames" connection="[[connection]]" result="{{measurementNames}}"
     query='SHOW MEASUREMENTS WITH MEASUREMENT =~ /(W631-ESP-PO)\./' regex=/.*\.(.*$)/></nimbus-influxdb-filter>
     [[measurementNames]]
    <br/>

<!--     <paper-button id="showCubism" raised>Show Cubism</paper-button> -->
    <cubism-chart wells="[[selectedWells]]" measurements="[[measurementNames]]" connection="[[connection]]"></cubism-chart>
  </template>


  <script>
    Polymer({
      is: 'nimbus-cubism-dashboard',
      
      listeners:{
        'execute.click':'executeClick',
        'showMeasurements.click': 'measurementClick',
        // 'showCubism.click': 'cubismClick',
      },
      
      properties: {
        prop1: {
          type: String,
          value: 'cubism-dashboard-app',
        },
      },
      initializeConnection: function() {
      this.connection = {
          url:'http://192.168.99.100:8086/query',
          user:'root',
          password:'root',
          db:'hfdata_samples'
      }
    },
      JSONstringify: function(conn){
        return JSON.stringify(conn, null, 2);
      },

      executeClick: function(){
        //this.$.query.handleQuery()
        this.$.wellNames.handleQuery();
        // var well = this.selectedWells;
        // console.log(well);
      },
      measurementClick: function(){
        this.$.measurementNames.handleQuery()
      },
      // cubismClick: function(){
      //   var well=this.selectedWells;
      //   console.log(well);
      // }

    });
  </script>
</dom-module>
